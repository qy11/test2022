<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

</body>
<script>
  /**
   *  实现思路
    创建一个对象
    在该对象上创建一个缓存列表（调度中心）
    on 方法用来把函数 fn 都加到缓存列表中（订阅者注册事件到调度中心）
    trigger 方法取到 arguments 里第一个当做 event，根据 event 值去执行对应缓存列表中的函数（发布者发布事件到调度中心，调度中心处理代码）
    off 方法可以根据 event 值取消订阅（取消订阅）
    once 方法只监听一次，调用完毕后删除缓存函数（订阅一次）
  */
  class EventEmitter {
    handlers = {}
    //订阅
    on(type, handler, once) {
      if (!this.handlers[type]) {
        this.handlers[type] = []
      }

      if (!this.handlers[type].includes(handler)) {
        this.handlers[type].push(handler)
        handler.once = once
      }
    }

    once(type, handler) {
      this.on(type, handler, true)
    }

    off(type, handler) {
      if (this.handlers[type]) {
        this.handlers[type] = this.handlers[type].filter(h => handler !== h)
      }
    }

    // 发布
    trigger(type) {
      if (this.handlers[type]) {
        this.handlers[type].forEach(handler => {
          handler.call(this)

          if (handler.once) {
            this.off(type, handler)
          }
        })
      }
    }

  }
  const ev = new EventEmitter()

  function handler1() {
    console.log('handler1')
  }
  function handler2() {
    console.log('handler2')
  }
  ev.on('test', handler1)
  ev.once('test', handler2)
  ev.trigger("test")
  ev.trigger("test")


</script>

</html>