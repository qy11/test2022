<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <ul id="list"></ul>
</body>
<script>

  /**
   * 观察者模式
  */
  class Target {
    constructor(data) {
      this.data = data
      this.observer = new Observer('list')
      this.init()

    }
    init() {
      this.validateData()
      this.proxyData()
    }
    validateData() {
      const { username, password, age, gender } = this.data;
      username.length < 6 && (data.username = '')
      password.length < 6 && (data.password = '')
      typeof age !== 'number' && (data.age = 0)
      !['male', 'female'].includes(gender) && (data.gender = 'male')
    }
    proxyData() {
      const _this = this;
      for (let key in this.data) {
        Object.defineProperty(this, key, {
          get() {
            console.log('get')
            this.observer.updateLog('get', key, _this.data[key])
            return _this.data[key]
          },
          set(newValue) {
            console.log('set', newValue)
            this.observer.updateLog('set', key, _this.data[key], newValue)
            _this.data[key] = newValue
          }
        })
      }
    }
  }
  class Observer {
    constructor(el) {
      this.el = document.getElementById(el)
      this.logPool = []
    }
    updateLog(type, key, oldValue, newValue) {
      switch (type) {
        case 'get':
          this.getProp(key, oldValue)
          break;
        case 'set':
          this.setProp(key, oldValue, newValue)
          break;
        default:
          break
      }
    }
    getProp(key, value) {
      const o = {
        type: 'get',
        dateTime: new Date(),
        key,
        value
      }
      this.logPool.push(o)
      this.log(o)
    }
    setProp(key, oldValue, newValue) {
      const o = {
        type: 'set',
        dateTime: new Date().getTime(),
        key,
        oldValue,
        newValue
      }
      this.logPool.push(o)
      this.log(o)
    }
    log(o) {
      const { type, dateTime, key } = o
      const oLi = document.createElement('li')
      let htmlStr = ''
      switch (o.type) {
        case 'get':
          htmlStr = ` ${dateTime}:就${key}离${o.value} `
          break
        case 'set':
          htmlStr = ` ${dateTime}:发${key}然${o.newValue}从${o.oldValue} `
          break;
        default:
          break
      }
      oLi.innerHTML = htmlStr
      this.el.appendChild(oLi)
      console.log('pppp', this.logPool)
    }
  }

</script>
<script src="./index.js"></script>

</html>